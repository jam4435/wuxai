你的任务是分析我提供的武侠小说内容，以事件为核心驱动，提取并生成符合指定格式的变量文件。人物的创建、成长和变化必须全部由具体的事件来驱动。

核心任务：
依据我的指令，读取小说文本。你需要仔细阅读和分析这些内容，并完成以下两项主要工作：

    提取并生成事件变量：这是你最核心的工作。所有人物信息都必须通过事件来创建和改变。

    通过事件差分，生成或更新人物变量：人物文件是事件应用后的结果，而非手动创建的起点。

请严格遵循下述格式和规则。

---

## 详细指令

### 1. 提取并生成事件变量 (首要任务)

对于改章节中发生的每一个独立且重要的情节，你都需要创建一个事件文件，并可以自行添加小说中一笔带过但有助于人物塑造的合理细节（例如：某角色的武功精进过程、两个角色关系的细微变化等）。

#### A. 人物初始化规则（登场事件）

**新角色必须通过专门的"登场事件"来初始化！** 当某一回出现新角色时（人物文件夹中不存在的角色），需要创建一个专门的登场事件文件来定义这些新角色的完整初始变量。

**登场事件命名格式**：`登场事件-第x回人物.json`

例如：第1回中郭啸天、杨铁心、李萍、包惜弱等角色首次出场，需要创建 `登场事件-第1回人物.json`，在其中使用 `insert` 完整定义所有该回新登场角色的初始变量（姓名、性别、外貌、性格、境界、属性、出生年份、状态、身份、功法等）。

**登场事件的特点**：

- 每一回最多只有一个登场事件文件
- 登场事件的触发时间应设置在该回第一个剧情事件前一年
- 登场事件中只包含 `insert` 操作，用于初始化新角色
- 创建登场事件后，需同步在人物文件夹中生成对应的人物JSON文件

**登场事件格式示例**：

```json
{
  "事件类型": "登场事件",
  "所属回目": "第1回",
  "触发条件": {
    "类型": "时间",
    "年": 1200,
    "月": 1,
    "日": 15,
    "时": 0
  },
  "新登场人物": ["郭啸天", "杨铁心", "李萍", "包惜弱"],
  "insert": {
    "郭啸天": {
      "姓名": "郭啸天",
      "性别": "男",
      "外貌": "身材魁梧，面容刚毅，高大健壮",
      "性格": "豪爽正直，重情重义",
      "境界": "三流-圆满",
      "初始属性": {
        "臂力": 12,
        "根骨": 11,
        "机敏": 9,
        "悟性": 8,
        "洞察": 10
      },
      "出生年份": 1170,
      "状态": "健康",
      "所在位置": "大宋/临安府/牛家村",
      "身份": {
        "农夫": "牛家村普通农户"
      },
      "功法": {
        "郭家枪法": {
          "掌握程度": "略有小成"
        }
      },
      "重要物品": {},
      "人物经历": {},
      "关系网": {
        "杨铁心": "挚友/85",
        "李萍": "妻子/95"
      }
    },
    "杨铁心": {
      "...": "（完整的人物初始变量）"
    }
  }
}
```

#### B. 对于已有人物，创建推动其变化的事件

事件名称格式：`事件条目-第x回-xx-[简洁名称].json`
示例：`事件条目-第1回-04-包惜弱巧救颜烈.json`

#### C. 事件变量格式

```json
{
  "事件地点": "事件发生的主要地点（层级格式，如：大宋/临安府/牛家村）",
  "触发条件": {
    "类型": "时间",
    "年": 1200,
    "月": 1,
    "日": 16,
    "时": 8
  },
  "事件结束时间": {
    "年": 1200,
    "月": 1,
    "日": 16,
    "时": 18
  },
  "事件引子": {
    "大宋/临安府": "你听说临安府南郊发生了一件大事..."
  },
  "后续事件": {
    "事件名": "第1回-05-牛家村风雪惊变",
    "描述": "后续剧情的提示描述..."
  },
  "事件详情": "（此处为300字左右的详尽叙述，需生动描绘事件的起因、经过、高潮和结果。重点描述人物的言行、心理活动及互动，确保情节饱满。）",
  "insert": {
    "人物姓名A": {
      "姓名": "人物姓名A",
      "性别": "性别",
      "外貌": "外貌描述（包含身材特征）",
      "性格": "性格描述",
      "境界": "武学境界（如：三流-圆满）",
      "初始属性": {
        "臂力": 10,
        "根骨": 10,
        "机敏": 10,
        "悟性": 10,
        "洞察": 10
      },
      "出生年份": 1170,
      "状态": "健康",
      "所在位置": "大宋/临安府/牛家村",
      "身份": {
        "身份键": "身份值"
      },
      "功法": {
        "功法名称": {
          "掌握程度": "初窥门径/略有小成/融会贯通/炉火纯青/出神入化"
        }
      },
      "重要物品": {
        "物品名称": "物品描述"
      },
      "人物经历": {
        "本事件名称": "在本事件中的具体经历总结"
      },
      "关系网": {
        "人物姓名B": "具体关系/好感度（如：结义兄弟/85、杀父仇人/-90）"
      }
    }
  },
  "update": {
    "人物姓名B": {
      "所在位置": "事件结束后的新位置",
      "境界": "提升后的境界",
      "功法": {
        "已有功法名称": {
          "掌握程度": "更新后的掌握程度"
        }
      },
      "性格": "因事件而产生变化的性格描述",
      "关系网": {
        "人物姓名A": "更新后的关系/好感度（如：恩人/75）"
      }
    }
  },
  "delete": {
    "人物姓名C": {
      "身份": {
        "过时的身份键": {}
      },
      "重要物品": {
        "已丢失或消耗的物品": {}
      }
    }
  }
}
```

#### D. 字段说明

| 字段         | 必填 | 说明                                                    |
| ------------ | ---- | ------------------------------------------------------- |
| 事件地点     | ✅    | 层级格式，如：大宋/临安府/牛家村                        |
| 触发条件     | ✅    | 类型固定为"时间"，需要年、月、日                        |
| 触发条件.时  | ❌    | 可选，0-23，仅当同一天有多个事件时使用                  |
| 事件结束时间 | ✅    | 事件结束的时间点                                        |
| 事件引子     | ❌    | 只需填写第二级地点（如"大宋/临安府"），用于生成附近传闻 |
| 后续事件     | ❌    | 事件完成后生成的后续线索                                |
| 事件详情     | ✅    | 300字左右的详尽叙述                                     |
| insert       | ❌    | 新增的数据，不存在时可省略                              |
| update       | ❌    | 修改的数据，不存在时可省略                              |
| delete       | ❌    | 删除的数据，不存在时可省略                              |

**注意事项：**

- `delete` 中使用空对象 `{}` 作为删除标记，符合 ERA 框架规范
- 若要删除整个人物，使用: `"人物姓名": {}`
- 如果某个差分类型（insert/update/delete）为空，可以直接省略不写
- 「时」字段为可选字段（0-23）。仅当同一天发生多个事件时，才需要添加「时」字段来区分事件的先后顺序

#### E. 时间推断规则

当小说文本未明确给出具体时间时，按以下规则推断：

1. **年份推断**：根据已知历史背景或人物年龄反推。如《射雕英雄传》开篇为南宋宁宗年间，可定为1200年前后
2. **月份推断**：根据季节描写推断（春：3-5月，夏：6-8月，秋：9-11月，冬：12-2月）；若无季节描写，默认为1月
3. **日期推断**：若无具体日期，默认为1日；同一章节内的连续事件按顺序递增
4. **时辰推断**：根据"清晨/午时/黄昏/深夜"等描写对应（清晨：6-8时，午时：11-13时，黄昏：17-19时，深夜：22-2时）；若无描写，默认为8时

#### F. insert/update/delete 使用规则

三种操作的核心区别：

| 操作   | 适用场景                     | 示例                                 |
| ------ | ---------------------------- | ------------------------------------ |
| insert | 新增不存在的键               | 人物首次获得某功法、新增某身份       |
| update | 修改已存在键的值（键名不变） | 功法掌握程度提升、境界突破、性格变化 |
| delete | 删除已存在的键               | 失去某身份、丢失某物品               |

**重要：键名替换必须使用 delete + insert 组合**

当需要将一个键替换为另一个键时（键名本身发生变化），不能使用 `update`，必须先 `delete` 旧键，再 `insert` 新键。

示例：人物身份从"丐帮弟子"变为"丐帮帮主"

```json
{
  "delete": {
    "人物姓名": {
      "身份": {
        "丐帮弟子": {}
      }
    }
  },
  "insert": {
    "人物姓名": {
      "身份": {
        "丐帮帮主": "统领丐帮数十万弟子"
      }
    }
  }
}
```

而非错误地使用 update：

❌ **错误示例**：update 只能修改值，不能替换键名

```json
{
  "update": {
    "人物姓名": {
      "身份": {
        "丐帮帮主": "统领丐帮数十万弟子"
      }
    }
  }
}
```

上述写法会新增"丐帮帮主"键，但不会删除原有的"丐帮弟子"键。

---

### 2. 生成与更新人物变量 (事件驱动的结果)

人物变量文件是应用了所有相关事件差分后的当前状态快照。它的作用是：

- 确定人物最新状态
- 为编写后续事件提供参照，确保事件中的人物差分不会与现有状态重复

#### A. 文件格式 ([人物姓名].json)

每个文件只包含一个 JSON 对象，记录该人物的当前完整状态。随着事件的推进，此文件会被不断更新。

#### B. 人物变量文件格式

```json
{
  "姓名": "郭啸天",
  "性别": "男",
  "外貌": "身材魁梧，面容刚毅，虎背熊腰，高大健壮",
  "性格": "豪爽正直，重情重义",
  "境界": "三流-圆满",
  "初始属性": {
    "臂力": 12,
    "根骨": 11,
    "机敏": 9,
    "悟性": 8,
    "洞察": 10
  },
  "出生年份": 1170,
  "状态": "健康",
  "所在位置": "大宋/临安府/牛家村",
  "身份": {
    "农夫": "牛家村普通农户"
  },
  "功法": {
    "郭家枪法": {
      "掌握程度": "略有小成"
    }
  },
  "重要物品": {},
  "人物经历": {
    "第1回-03-郭杨义结金兰": "与杨铁心结为异姓兄弟",
    "第1回-05-牛家村风雪惊变": "被金兵追杀，力战身亡"
  },
  "关系网": {
    "杨铁心": "结义兄弟/92",
    "李萍": "妻子/95",
    "包惜弱": "弟妹/80"
  }
}
```

#### C. 人物变量完整字段列表

| 字段     | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| 姓名     | string | 人物姓名                                                     |
| 性别     | string | 男/女                                                        |
| 外貌     | string | 外貌特征描述（包含身材特征）                                 |
| 性格     | string | 性格特征描述                                                 |
| 境界     | string | 武学境界，如"三流-圆满"、"二流-初期"等                       |
| 初始属性 | object | 5维天赋属性（臂力/根骨/机敏/悟性/洞察），范围0-20  |
| 出生年份 | number | 出生年份，用于计算年龄                                       |
| 状态     | string | 当前状态，如"健康"、"重伤"、"中毒"等                         |
| 所在位置 | string | 当前所在位置，层级格式                                       |
| 身份     | object | 键为身份名，值为身份描述                                     |
| 功法     | object | 键为功法名，值为包含"掌握程度"的对象（其他信息由数据库补全） |
| 重要物品 | object | 键为物品名，值为物品描述                                     |
| 人物经历 | object | 键为事件名，值为该人物在事件中的经历                         |
| 关系网   | object | 键为其他人物姓名，值为"具体关系/好感度"格式，如"挚友/92"     |

若某字段暂无内容，使用空对象 `{}` 或空字符串 `""`，不可省略字段。

#### D. 初始属性取值指南

| 数值范围 | 等级描述  | 适用角色           |
| -------- | --------- | ------------------ |
| 0-4      | 愚钝/残缺 | 有明显缺陷的角色   |
| 5-8      | 普通      | 普通人、配角       |
| 9-12     | 人才      | 有一定天赋的角色   |
| 13-16    | 天才      | 主要角色、门派高手 |
| 17-20    | 妖孽      | 顶尖高手、主角     |

**示例参考**：

- 普通农夫：各项 5-8
- 江湖好手：主属性 10-12，其他 8-10
- 门派精英：主属性 13-15，其他 10-12
- 绝世高手：主属性 17-20，多项 14+

#### E. 功法填写规则

1. **无功法角色**：普通人可填空对象 `{}`
2. **只有武技的角色**：只填武技，无需补充内功
3. **高境界但无内功描写**：无需补充，前端会自动应用境界保底

**掌握程度等级**：

- 初窥门径 → 略有小成 → 融会贯通 → 炉火纯青 → 出神入化

**示例**：

- 普通村民：`"功法": {}`
- 只会枪法的好汉：`"功法": { "杨家枪": { "掌握程度": "略有小成" } }`
- 欧阳锋（只描写蛤蟆功）：`"功法": { "蛤蟆功": { "掌握程度": "出神入化" } }`

---

## 工作流程

1. **主动读取**：读取 射雕/射雕英雄传文件夹 中指定回目的小说文本。

2. **识别新登场人物并创建登场事件**（在"射雕/事件"文件夹中创建）：

    a. 首先检查该回中出现的所有人物，对比"射雕/人物变量"文件夹，识别出哪些是新角色（人物文件夹中不存在的角色）。

    b. **为该回的新角色创建登场事件**：创建 `登场事件-第x回人物.json`，在其中使用 `insert` 完整定义所有该回新登场角色的初始变量（姓名、性别、外貌、性格、境界、属性、出生年份、状态、身份、功法等）。

    c. **同步生成人物JSON文件**：创建登场事件后，立即在"射雕/人物变量"文件夹中为每个新角色生成对应的人物JSON文件，内容与登场事件中的 `insert` 数据一致。

3. **提取剧情事件**（在"射雕/事件"文件夹中创建）：

    a. 识别文本中所有已发生的事件，为每一个事件创建独立的事件文件。尽力拆分为更小的事件单元。

    b. 可以合理推断并创建小说中未详述但逻辑上必然存在的事件，以丰富人物成长弧光。

    c. 在填写 insert, update, delete 时，必须以人物JSON文件中的键（key）是否存在为唯一判断标准。此原则适用于所有层级，包括根层级和嵌套对象内部。
    写事件中的人物差分时，先搜索 射雕/人物变量 里的人物.json（人物json就是为了判断应该用insert/update/delete中的哪一个而存在的）。如新增人物json里没有的键值对的部分使用insert，需要修改键值对使用update，删除键值对使用delete。注意：替换键值对不能用update，而是先delete再insert

4. **更新人物文件**（在"射雕/人物变量"文件夹中更新）：

    根据剧情事件的 update 和 delete 操作，更新已存在角色的人物文件中的"最新人物变量"。

---

## 事件文件类型总结

| 事件类型 | 命名格式                            | 用途                       | 包含操作                   |
| -------- | ----------------------------------- | -------------------------- | -------------------------- |
| 登场事件 | `登场事件-第x回人物.json`           | 初始化该回新登场的所有角色 | 仅 `insert`                |
| 剧情事件 | `事件条目-第x回-xx-[简洁名称].json` | 记录剧情发展，推动人物变化 | `insert`/`update`/`delete` |

**处理顺序**：每一回必须先创建登场事件和对应的人物JSON文件，然后再创建剧情事件。这样可以确保在编写剧情事件时，能够正确判断应该使用 insert、update 还是 delete。
