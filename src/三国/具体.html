<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”å¹»ä¸‰å›½RPG - çŠ¶æ€é¢æ¿ (åŠ¨æ€åŠ è½½ç‰ˆ)</title>
    <style>
        /* å¼•å…¥ä¸¤æ¬¾æ–°çš„è‰ºæœ¯å­—ä½“ï¼šZCOOL KuaiLe (æ ‡é¢˜æ¯›ç¬”å­—) å’Œ Ma Shan Zheng (æ­£æ–‡æ‰‹å†™æ¥·ä½“) */
		@import url('https://fonts.googleapis.com/css2?family=Long+Cang&family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&family=ZCOOL+KuaiLe&family=Zhi+Mang+Xing&display=swap');
		:root {
			/* ç§»é™¤æ‰€æœ‰æ—§å˜é‡ï¼Œæ¢æˆä¸€å¥—å…¨æ–°çš„â€œæ°´å¢¨é£â€å˜é‡ */
			--bg-color: #0a0b0d; /* èƒŒæ™¯è‰²ä¿æŒä¸å˜ */
			--container-bg: #1a1d23;
			
			/* --- å…¨æ–°çš„æ°´å¢¨é£è‰²æ¿ --- */
			--ink-text-main: #3a2e24;      /* ä¸»æ–‡å­—é¢œè‰² - åƒæµ“å¢¨ */
			--ink-text-secondary: #6b5a4b; /* æ¬¡è¦æ–‡å­—é¢œè‰² - åƒæ·¡å¢¨ */
			--ink-accent: #8c3b32;         /* å¼ºè°ƒè‰² - åƒå°æ³¥çš„æš—çº¢è‰² */
			--ink-border: rgba(58, 46, 36, 0.4); /* è¾¹æ¡†é¢œè‰² - æ·¡æ·¡çš„å¢¨è¿¹ */

			/* ç»Ÿä¸€å°†æ—§å˜é‡æŒ‡å‘æ–°å˜é‡ï¼Œæˆ–è€…åœ¨åç»­ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æ–°å˜é‡ */
			--text-primary: var(--ink-text-main);
			--text-secondary: var(--ink-text-secondary);
			--accent-color: var(--ink-accent);
			--border-color: var(--ink-border);

			/* å¡ç‰‡èƒŒæ™¯æˆ‘ä»¬ä¸å†éœ€è¦äº†ï¼Œå› ä¸ºå®ƒæ˜¯å·è½´å›¾ç‰‡ */
			--card-bg: transparent; 
		}

        * {
            box-sizing: border-box;
        }

		body {
			/* å°†é»˜è®¤å­—ä½“æ”¹ä¸ºæ‰‹å†™æ¥·ä½“ */
			font-family: 'Ma Shan Zheng', serif;
			font-weight: 600; /* åŠ ç²—ä¸€ç‚¹è®©æ‰‹å†™ä½“æ›´æ¸…æ™° */
			background: linear-gradient(135deg, #0a0b0d 0%, #1a1d23 50%, #0f1217 100%);
			background-attachment: fixed;
			color: var(--text-primary);
			margin: 0;
			padding: 20px;
			display: flex;
			justify-content: center;
			align-items: flex-start;
			min-height: 100vh;
			position: relative;
			overflow-x: hidden;
		}

		/* è¿™æ˜¯æ¨èä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå¸¦æœ‰ä¸€ä¸ªåŠé€æ˜çš„é»‘è‰²é®ç½©ï¼Œèƒ½æ›´å¥½åœ°çªå‡ºå‰æ™¯UI */
		body::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			
			/* ä½¿ç”¨ background å±æ€§å åŠ èƒŒæ™¯å±‚ */
			background: 
				/* ç¬¬1å±‚ï¼šåŠé€æ˜é»‘è‰²é®ç½© (0.6ä»£è¡¨60%ä¸é€æ˜åº¦ï¼Œæ‚¨å¯ä»¥æ ¹æ®å–œå¥½è°ƒæ•´) */
				linear-gradient(rgba(10, 11, 13, 0.6), rgba(10, 11, 13, 0.6)),
				/* ç¬¬2å±‚ï¼šæ‚¨çš„æ°´å¢¨ç”»èƒŒæ™¯å›¾ç‰‡ (ç²˜è´´åœ¨è¿™é‡Œï¼) */
				url('https://raw.githubusercontent.com/jam4435/my-image-hosting/main/ä¸‰å›½/%E6%B0%B4%E5%A2%A8%E8%83%8C%E6%99%AF.webp');

			background-size: cover;          /* è®©å›¾ç‰‡é“ºæ»¡æ•´ä¸ªå±å¹• */
			background-position: center;     /* è®©å›¾ç‰‡å±…ä¸­æ˜¾ç¤º */
			background-repeat: no-repeat;    /* å›¾ç‰‡ä¸é‡å¤ */
			background-attachment: fixed;    /* å›ºå®šèƒŒæ™¯ï¼Œæ»šåŠ¨æ—¶ä¸åŠ¨ */

			pointer-events: none;
			z-index: -1;
		}

        .status-panel {
            width: 100%;
            max-width: 1000px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-primary);
            position: relative;
        }

        .status-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            opacity: 0.8;
        }
		
		/* --- â†“â†“â†“ æŠŠè¿™æ®µä»£ç åŠ åœ¨è¿™é‡Œ â†“â†“â†“ --- */
        .tabs {
            display: flex;
            /* backdrop-filter: blur(10px); */ /* ç§»é™¤å†²çªå±æ€§ */
            border-bottom: 2px solid var(--accent-color);
            position: relative;
        }
        /* --- â†‘â†‘â†‘ ä»£ç åŠ åœ¨è¿™é‡Œ â†‘â†‘â†‘ --- */


		/* --- å…¨æ–°çš„æ¨ªå‘å·è½´å¯¼èˆªæ æ ·å¼ --- */

		/* 1. æ•´ä½“å®¹å™¨ï¼šä½¿ç”¨å•ä¸ªå·è½´å›¾ç‰‡ä½œä¸ºèƒŒæ™¯ */
		.tabs {
			display: flex;
			justify-content: space-around; /* å°†æ–‡å­—å‡åŒ€åˆ†å¸ƒ */
			align-items: center;       /* å‚ç›´å±…ä¸­ */
			width: 100%;
			max-width: 800px; /* æ ¹æ®å›¾ç‰‡æ¯”ä¾‹è°ƒæ•´ä¸€ä¸ªæœ€å¤§å®½åº¦ */
			height: 80px;              /* æ ¹æ®å›¾ç‰‡é«˜åº¦è°ƒæ•´ */
			margin: 10px auto;         /* å±…ä¸­å¹¶å¢åŠ ä¸Šä¸‹è¾¹è· */
			padding: 0 80px;           /* åœ¨å·è½´ä¸¤ç«¯ç•™å‡ºç©ºç™½ï¼Œé¿å…æ–‡å­—å‹åˆ°è½´å¤´ */
			
			background: url('https://raw.githubusercontent.com/jam4435/my-image-hosting/main/ä¸‰å›½/æ¨ªè½´2.webp') no-repeat center center;
			background-size: 100% 100%; /* å¼ºåˆ¶æ‹‰ä¼¸ä»¥å¡«æ»¡å®¹å™¨ */

			border-bottom: none; /* ç§»é™¤æ—§çš„è¾¹æ¡† */
		}

		/* 2. ç¦ç”¨æ‰€æœ‰::beforeä¼ªå…ƒç´  */
		.tabs::before,
		.tab::before {
			display: none;
		}

		/* 3. å•ä¸ªæ ‡ç­¾é¡µï¼šç°åœ¨åªæ˜¯çº¯æ–‡æœ¬å®¹å™¨ */
		.tab {
			flex: 1;
			text-align: center;
			cursor: pointer;
			font-size: 1.3em;
			color: #f5e6c8; /* æ›´æ¢ä¸ºæ˜äº®çš„ç±³ç™½è‰² */
			font-family: 'Ma Shan Zheng', serif;
			font-weight: 700;
			transition: all 0.3s ease;
			text-shadow: 0 0 3px rgba(255, 255, 255, 0.4); /* æ·»åŠ æµ…è‰²å…‰æ™•ä»¥å¢å¼ºå¯è¯»æ€§ */
			
			/* ç§»é™¤æ‰€æœ‰æ—§çš„è¾¹æ¡†å’ŒèƒŒæ™¯æ ·å¼ */
			background: none;
			border: none;
			height: auto;
		}

		/* 4. æ¿€æ´»çŠ¶æ€çš„æ ‡ç­¾é¡µ */
		.tab.active {
			color: #fff; /* æ¿€æ´»çŠ¶æ€ä½¿ç”¨æœ€äº®çš„ç™½è‰²ä»¥ä¿è¯æ¸…æ™°åº¦ */
			transform: scale(1.1);
			text-shadow: 0 0 8px var(--ink-accent); /* ä½¿ç”¨ä¸»é¢˜çº¢è‰²ä½œä¸ºå…‰æ™•æ¥æ ‡è¯†çŠ¶æ€ */
		}

		/* 5. é¼ æ ‡æ‚¬åœåœ¨æœªæ¿€æ´»çš„æ ‡ç­¾é¡µä¸Š */
		.tab:hover:not(.active) {
			color: #fff; /* æ‚¬åœæ—¶å˜ä¸ºçº¯ç™½è‰²ä»¥ç¤ºåŒºåˆ† */
			transform: scale(1.05);
		}

        .content-panel {
            display: none;
            padding: 35px;
            animation: fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .content-panel.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

		.card {
			/* ç§»é™¤æ—§çš„èƒŒæ™¯ã€è¾¹æ¡†å’Œé˜´å½±ï¼Œä¸ºæ–°çš„å·è½´æ ·å¼åšå‡†å¤‡ */
			background: transparent; /* å¿…é¡»è®¾ä¸ºé€æ˜ï¼Œè®©border-imageçš„ä¸­é—´éƒ¨åˆ†å¡«å……è¿›æ¥ */
			position: relative;
			transition: all 0.3s ease;
			
			/* --- æ ¸å¿ƒï¼šä½¿ç”¨ border-image ç»˜åˆ¶å·è½´ --- */
			
			/* 1. å®šä¹‰ä¸€ä¸ªè¾¹æ¡†åŒºåŸŸï¼Œå›¾ç‰‡çš„å„ä¸ªéƒ¨åˆ†å°†ä¼šè¢«ç»˜åˆ¶åœ¨è¿™é‡Œ */
			border-style: solid;
			border-width: 35px 120px; /* ä¸Šä¸‹è¾¹æ¡†35pxï¼Œå·¦å³è¾¹æ¡†120pxï¼ˆè¿™æ˜¯å·è½´å¤´çš„å®½åº¦ï¼‰ */

			/* 2. å…³é”®ï¼æŒ‡å®šç”¨å“ªå¼ å›¾ç‰‡ä»¥åŠå¦‚ä½•â€œåˆ‡å‰²â€å’Œåº”ç”¨å®ƒ */
			border-image-source: url('https://raw.githubusercontent.com/jam4435/my-image-hosting/main/ä¸‰å›½/%E5%8D%B7%E8%BD%B43.webp');
			border-image-slice: 50 130 50 130 fill; /* ä»å›¾ç‰‡è¾¹ç¼˜å‘å†…åˆ‡å‰²ã€‚fillæ˜¯è®©å›¾ç‰‡ä¸­é—´éƒ¨åˆ†å¡«å……èƒŒæ™¯ */
			border-image-repeat: stretch; /* æ‹‰ä¼¸å›¾ç‰‡çš„è¾¹ç¼˜æ¥å¡«å……è¾¹æ¡†åŒºåŸŸ */

			/* è°ƒæ•´å†…éƒ¨å†…å®¹çš„é—´è·ï¼Œä»¥é€‚åº”æ–°çš„â€œè¾¹æ¡†â€ */
			padding: 20px 40px; 
		}

		/* å·è½´æ ·å¼ä¸éœ€è¦å·¦è¾¹çš„é‡‘è‰²ç«–çº¿äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠè¿™ä¸ªä¼ªå…ƒç´ æ¸…ç©º */
		.card::before {
			display: none; 
		}

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-primary), var(--glow-accent);
            border-color: rgba(212, 175, 55, 0.5);
        }

		.card h3 {
			margin-top: 0;
			margin-bottom: 20px;
			color: var(--text-primary); /* æ ‡é¢˜é¢œè‰²ä½¿ç”¨ä¸»å¢¨è‰² */
			font-size: 1.8em; /* æŠŠæ¯›ç¬”å­—æ ‡é¢˜æ”¾å¤§ä¸€ç‚¹æ›´æœ‰æ°”åŠ¿ */
			border-bottom: 2px solid var(--ink-border); /* ç»†ç»†çš„å¢¨è¿¹ä¸‹åˆ’çº¿ */
			padding-bottom: 15px;
			display: flex;
			align-items: center;
			gap: 10px;
			font-family: 'ZCOOL KuaiLe', cursive; /* åº”ç”¨æ¯›ç¬”å­—ä½“ */
			font-weight: normal; /* æ¯›ç¬”å­—ä¸éœ€è¦é¢å¤–åŠ ç²— */
		}

		/* ç¦ç”¨åŸæ¥çš„æ˜Ÿå½¢å›¾æ ‡ */
		.card h3::before {
			display: none;
		}

		/* --- æ–°å¢ï¼šç”¨äºç«–å‘æ ‡é¢˜å¸ƒå±€çš„æ ·å¼ --- */
		.card.vertical-layout {
			display: flex;
			align-items: stretch; /* ä¿æŒstretchï¼Œè®©å†…å®¹åŒºä»é¡¶éƒ¨å¼€å§‹å¯¹é½ */
			gap: 10px; /* è¿›ä¸€æ­¥å‡å°é—´è· */
			/* æ ¸å¿ƒä¿®å¤ï¼šè¦†ç›–.cardçš„é»˜è®¤å·¦å³å†…è¾¹è·ï¼Œä¸ºå¸ƒå±€è…¾å‡ºç©ºé—´ */
			padding-left: 0px;  /* æé™å‡å°‘å·¦è¾¹è· */
			padding-right: 10px; /* è¿›ä¸€æ­¥å¢åŠ å³è¾¹è·ï¼Œè®©å†…å®¹åŒºæ›´å®½ */
		}

		.card.vertical-layout > h3 {
			writing-mode: vertical-rl;
			text-orientation: mixed;
			white-space: nowrap;
			flex-shrink: 0;
			
			/* Override existing .card h3 styles */
			font-family: 'Ma Shan Zheng', cursive; /* æ”¹å›é©¬å–„æ”¿æ¥·ä½“ */
			margin: auto 0; /* æ ¸å¿ƒä¿®å¤ï¼šè®©æ ‡é¢˜åœ¨å‚ç›´æ–¹å‘ä¸Šè‡ªåŠ¨å±…ä¸­ */
			border-bottom: none;
			padding-bottom: 0;
			padding-left: 0;
			padding-right: 10px; /* æ ‡é¢˜å’Œå†…å®¹çš„é—´è· */
		}

		.card.vertical-layout > div {
			flex-grow: 1;
			position: relative; /* ä¸ºå†…éƒ¨ç»å¯¹å®šä½çš„æŒ‰é’®æä¾›å®¹å™¨ */
		}

		#world-state-list {
			max-height: 300px; /* ä¸äººç‰©å…³ç³»åˆ—è¡¨é«˜åº¦ä¸€è‡´ */
			overflow-y: auto;  /* å…è®¸å†…å®¹æ»šåŠ¨ */
			padding-right: 10px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */
		}

		#skills-list-container {
			max-height: 300px; /* è®¾ç½®ä¸€ä¸ªæœ€å¤§é«˜åº¦ */
			overflow-y: auto;  /* å†…å®¹è¶…å‡ºæ—¶æ˜¾ç¤ºæ»‘åŠ¨æ¡ */
			padding-right: 10px; /* ä¸ºæ»‘åŠ¨æ¡ç•™å‡ºç©ºé—´ */
		}

		.seal-button {
			position: absolute;
			top: -15px; /* è°ƒæ•´ä½ç½®ï¼Œä¸æŒ¤å å†…å®¹ç©ºé—´ */
			right: -5px;
			width: 50px;
			height: 50px;
			cursor: pointer;
			transition: transform 0.3s ease, filter 0.3s ease;
			z-index: 10;
		}
		.seal-button:hover {
			transform: scale(1.1) rotate(10deg);
			filter: brightness(1.2);
		}

		.card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 12px;
        }

        .card-header h3 {
            margin: 0;
            padding: 0;
            border: none;
        }

        .card-header .action-btn {
            margin-top: 0;
            float: none;
        }
		.stat-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 12px;
			font-size: 1.1em; /* ç¨å¾®æ”¾å¤§æ­£æ–‡ï¼Œé…åˆæ–°å­—ä½“ */
			padding: 12px 0;
			
			/* ç§»é™¤æ‰€æœ‰èƒŒæ™¯ã€è¾¹æ¡†å’Œæ•ˆæœï¼Œåªç•™ä¸€æ¡åº•çº¿ï¼Œåƒæ˜¯åœ¨çº¸ä¸Šç”»çš„åˆ†å‰²çº¿ */
			background: none;
			border-radius: 0;
			border-left: none;
			border-bottom: 1px solid var(--ink-border);
			transition: all 0.3s ease;
		}

		/* ç§»é™¤é¼ æ ‡æ‚¬åœæ•ˆæœï¼Œæˆ–è€…æ”¹æˆæ›´æœ´ç´ çš„æ•ˆæœ */
		.stat-item:hover {
			background: rgba(82, 62, 48, 0.05); /* æ‚¬åœæ—¶ä¸€å±‚ææ·¡çš„å¢¨è‰² */
			border-bottom-color: var(--ink-accent);
			transform: none; /* ç§»é™¤ä½ç§» */
		}

		.stat-label {
			color: var(--text-secondary);
			font-weight: normal; /* ä½¿ç”¨å­—ä½“çš„é»˜è®¤ç²—ç»† */
		}

		/* ç§»é™¤æ•°å€¼çš„èƒŒæ™¯æ¡† */
		.stat-value {
			font-weight: bold;
			color: var(--text-primary);
			padding: 0;
			background: none;
			border-radius: 0;
		}
        .list-item {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(74, 77, 85, 0.3);
            background: rgba(0, 0, 0, 0.1);
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: rgba(212, 175, 55, 0.05);
            border-left-color: var(--accent-color);
            transform: translateX(5px);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        th {
            color: var(--accent-color);
            background: rgba(212, 175, 55, 0.1);
            font-weight: 700;
        }

        tr:hover td {
            background: rgba(212, 175, 55, 0.05);
        }

        .character-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-color), rgba(212, 175, 55, 0.3));
        }

        .character-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-primary);
            border-color: rgba(212, 175, 55, 0.4);
        }

        .character-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .character-name {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .character-relation {
            font-style: italic;
            color: var(--accent-color);
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .character-intimacy {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .character-description {
            font-size: 0.95em;
            line-height: 1.6;
        }

        .character-details {
            font-size: 0.9em;
            color: var(--text-secondary);
            padding: 8px 0 12px 0;
            border-bottom: 1px solid rgba(74, 77, 85, 0.3);
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.1);
            padding: 12px;
            border-radius: 6px;
        }

        .character-details p {
            margin: 6px 0;
        }

        .character-details p strong {
            color: var(--text-primary);
        }

        .action-btn {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin-top: 8px;
            float: right;
            box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 17, 203, 0.4);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            border: 2px solid var(--border-color);
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-primary);
            animation: modalSlideIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .modal-title {
            margin: 0;
            color: var(--accent-color);
            font-size: 1.4em;
            font-weight: 700;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close-btn:hover {
            color: var(--accent-color);
            background: rgba(212, 175, 55, 0.1);
            transform: rotate(90deg);
        }

        .modal-body {
            overflow-y: auto;
            padding-right: 10px;
        }

        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .relationship-card {
            background: var(--card-bg);
            border: 1px solid rgba(201, 170, 113, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-secondary);
            transition: all 0.3s ease;
        }

        .relationship-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-primary);
        }

        .relationship-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(201, 170, 113, 0.2);
        }

        .relationship-name {
            font-size: 18px;
            font-weight: bold;
        }

        .relationship-relation {
            font-size: 14px;
            color: var(--text-muted);
            font-style: italic;
        }

        .relationship-body {
            font-size: 13px;
            line-height: 1.7;
        }

        .relationship-body p {
            margin-bottom: 10px;
        }

        .favorability-bar-container {
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            margin-top: 8px;
            border: 1px solid #8b7355;
            overflow: hidden;
        }

        .favorability-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b4513, #cd853f);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .relationship-id {
            font-size: 12px;
            color: var(--accent-color);
            font-weight: bold;
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .delete-relationship-btn {
            background: linear-gradient(135deg, #d32f2f, #f44336);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(211, 47, 47, 0.3);
        }

        .delete-relationship-btn:hover {
            background: linear-gradient(135deg, #b71c1c, #d32f2f);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.5);
        }

        .relationship-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-bottom: 25px;
            background: rgba(201, 170, 113, 0.1);
            border: 1px solid rgba(201, 170, 113, 0.3);
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .reorder-relationships-btn {
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(106, 17, 203, 0.3);
        }

        .reorder-relationships-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 17, 203, 0.4);
        }

        .relationship-count {
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .event-history {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(201, 170, 113, 0.2);
        }

        .event-history h4 {
            margin: 0 0 12px 0;
            color: var(--accent-color);
            font-size: 1em;
        }

        .event-history ul {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .event-history ul li {
            line-height: 1.6;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            border-left: 3px solid rgba(212, 175, 55, 0.3);
            position: relative;
        }

        .event-history ul li::before {
            content: 'â—¦';
            color: var(--accent-color);
            font-weight: bold;
            margin-right: 8px;
        }

  /* --- æ–°å¢ï¼šé’ˆå¯¹äººç‰©å…³ç³»æ¨¡æ€çª—å£çš„æ ·å¼ä¼˜åŒ– --- */
  #relationships-modal .relationship-card {
  	background: rgba(20, 22, 26, 0.7);
  	border: 1px solid var(--ink-border);
  	box-shadow: none;
  }

  #relationships-modal .relationship-name,
  #relationships-modal .relationship-body,
  #relationships-modal .relationship-body p,
  #relationships-modal .relationship-relation,
  #relationships-modal .event-history ul li,
  #relationships-modal .relationship-count {
  	color: #fff; /* ç»Ÿä¸€ä½¿ç”¨çº¯ç™½è‰² */
  	font-family: sans-serif; /* ä½¿ç”¨æ¸…æ™°çš„éè¡¬çº¿å­—ä½“ */
  }

  #relationships-modal .event-history h4 {
  	color: var(--ink-accent);
  	font-family: sans-serif;
  }

  #relationships-modal .event-history ul li {
  	background: rgba(0,0,0,0.3);
  }

  #relationships-modal .relationship-controls {
  	background: rgba(20, 22, 26, 0.7);
  	border: 1px solid var(--ink-border);
  }

        /* å“åº”å¼è®¾è®¡ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .status-panel {
                max-width: 100%;
            }
            
            .content-panel {
                padding: 20px;
            }
            
            .grid-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
    
      /* --- æ‰‹æœºç«¯é€‚é…ï¼šå¸ƒå±€è°ƒæ•´ --- */
      .card {
       border-width: 30px 60px; /* å‡å°å·è½´å¤´å®½åº¦ */
       padding: 15px 20px;    /* å‡å°å†…éƒ¨é—´è· */
      }
    
      .card.vertical-layout {
       display: block; /* æ¢å¤ä¸ºå—çº§å¸ƒå±€ï¼Œå–æ¶ˆflex */
      }
    
      .card.vertical-layout > h3 {
       writing-mode: horizontal-tb; /* æ–‡å­—æ¢å¤æ°´å¹³æ–¹å‘ */
       margin: 0 0 15px 0;         /* æ¢å¤ä¸‹è¾¹è· */
       padding: 0 0 10px 0;        /* æ¢å¤ä¸‹å†…è¾¹è· */
       border-bottom: 2px solid var(--ink-border); /* æ¢å¤ä¸‹åˆ’çº¿ */
       text-align: center;         /* æ ‡é¢˜å±…ä¸­ */
       font-size: 1.5em;           /* è°ƒæ•´å­—ä½“å¤§å° */
      }
            
            .tab {
                font-size: 1em;
                padding: 15px 8px;
            }

   /* --- æ‰‹æœºç«¯é€‚é…ï¼šå¯¼èˆªæ ä¼˜åŒ– --- */
   .tabs {
   	height: 60px; /* ç¼©å°é«˜åº¦ */
   	padding: 0 40px; /* å‡å°å·¦å³å†…è¾¹è· */
   	max-width: 100%;
   }
 
   /* --- æ‰‹æœºç«¯é€‚é…ï¼šå­—ä½“ä¸é—´è· --- */
   .stat-item {
   	font-size: 1em;
   	padding: 8px 0;
   }
   .list-item {
   	font-size: 0.9em;
   	padding: 10px 12px;
   }
   th, td {
   	padding: 12px 8px;
   	font-size: 0.9em;
   }
 
   /* --- æ‰‹æœºç«¯é€‚é…ï¼šäº¤äº’å…ƒç´  --- */
   .seal-button {
   	width: 40px;
   	height: 40px;
   	top: -10px;
   	right: 0;
   }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* å¢å¼ºçš„æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-color), rgba(212, 175, 55, 0.6));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--accent-hover), var(--accent-color));
        }
    </style>
</head>
<body>

<div class="status-panel">
    <div class="tabs">
		<!-- ä¿®æ”¹å -->
		<div class="tab active" data-panel-id="char-progression">è§’è‰²æˆé•¿</div>
		<div class="tab" data-panel-id="faction-status">åŠ¿åŠ›</div>
		<div class="tab" data-panel-id="world-status">äººç‰©ä¸å¤©ä¸‹</div>
    </div>
    
    <!-- è§’è‰²æˆé•¿ -->
    <div id="char-progression" class="content-panel active">
        <div class="grid-container">
            <div class="card vertical-layout">
                <h3>æ ¸å¿ƒèº«ä»½</h3>
                <div>
                    <div class="stat-item"><span class="stat-label">èº«ä»½/å®˜èŒ</span><span id="status-identity" class="stat-value"></span></div>
                    <div class="stat-item"><span class="stat-label">å£°æœ›</span><span id="status-reputation" class="stat-value"></span></div>
                </div>
            </div>
            <div class="card vertical-layout">
                <h3>èƒ½åŠ›æ ¸å¿ƒ</h3>
                <div>
                    <div class="stat-item"><span class="stat-label">èŒä¸šä¸ç­‰çº§</span><span id="status-class-level" class="stat-value"></span></div>
                    <div class="stat-item"><span class="stat-label">é¾™è¡€å¤©èµ‹</span><span id="status-dragon-talent" class="stat-value"></span></div>
                </div>
            </div>
        </div>
        <div class="card vertical-layout" style="margin-top: 25px;">
            <h3>æŠ€èƒ½å’Œä¸“é•¿</h3>
            <div id="skills-list-container">
                <ul id="status-skills-list" style="padding-left: 0; margin: 0; list-style-type: none;"></ul>
            </div>
        </div>
    </div>
    
    <!-- åŠ¿åŠ› -->
    <div id="faction-status" class="content-panel">
        <div class="grid-container">
            <div class="card vertical-layout">
                <h3>æˆ˜ç•¥èµ„æº</h3>
                <div>
                    <div class="stat-item"><span class="stat-label">ğŸ’° é‡‘é’±</span><span id="res-money" class="stat-value"></span></div>
                    <div class="stat-item"><span class="stat-label">ğŸŒ¾ ç²®è‰</span><span id="res-food" class="stat-value"></span></div>
                </div>
            </div>
            <div class="card vertical-layout">
                <h3>é¢†åœ°</h3>
                <div>
                    <ul id="faction-territories-list" style="padding-left: 0; margin: 0; list-style-type: none;"></ul>
                </div>
            </div>
        </div>
        <div class="card vertical-layout" style="margin-top: 25px;">
            <h3>å†›é˜Ÿ</h3>
            <div id="faction-army-list">
                 <table><thead><tr><th>éƒ¨é˜Ÿåç§°</th><th>æ•°é‡</th><th>å…µç§</th><th>çŠ¶æ€</th></tr></thead><tbody id="faction-army-tbody"></tbody></table>
            </div>
        </div>
    </div>
    
    <!-- äººç‰©ä¸å¤©ä¸‹å¤§åŠ¿ -->
    <div id="world-status" class="content-panel">
        <div class="card vertical-layout">
            <h3>äººç‰©å…³ç³» (æ¦‚è§ˆ)</h3>
            <div>
                <img src="https://raw.githubusercontent.com/jam4435/my-image-hosting/main/ä¸‰å›½/%E7%8E%89%E7%8E%BA1.webp" class="seal-button" alt="ç®¡ç†å…³ç³»ç½‘ç»œ" onclick="GuixuManager.showRelationships()">
                <div id="relations-character-list" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                    <!-- JSåŠ¨æ€å¡«å…… -->
                </div>
            </div>
        </div>
        <div class="card vertical-layout" style="margin-top: 25px;">
            <h3>å¤©ä¸‹å¤§åŠ¿</h3>
            <div id="world-state-list" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                 <table><thead><tr><th>åŠ¿åŠ›</th><th>å›ä¸»</th><th>çŠ¶æ€</th><th>å…³ç³»</th></tr></thead><tbody id="world-state-tbody"></tbody></table>
            </div>
        </div>
        <div class="grid-container" style="margin-top: 25px;">
            <div class="card vertical-layout">
                <h3>æ—¶é—´ä¸å¹´é¾„</h3>
                <div>
                    <div class="stat-item"><span class="stat-label">â° å½“å‰æ—¶é—´</span><span id="world-time" class="stat-value"></span></div>
                     <div class="stat-item"><span class="stat-label">ğŸ‘¤ ç”Ÿç†å¹´é¾„</span><span id="world-age" class="stat-value"></span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- äººç‰©å…³ç³»æ¨¡æ€çª—å£ -->
<div id="relationships-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header"><h2 class="modal-title">ğŸ¤ äººç‰©å…³ç³»ç®¡ç†</h2><button class="modal-close-btn" onclick="GuixuManager.closeModal('relationships-modal')">Ã—</button></div>
      <div class="modal-body"></div>
    </div>
</div>

<script>
    // =======================================================================
    // I. æ ¸å¿ƒ API äº¤äº’ä¸å·¥å…· (æ— éœ€æ”¹åŠ¨)
    // =======================================================================
    async function getGameData() {
        try {
            // ä½¿ç”¨æ–°çš„ API getVariables è·å–æœ€æ–°æ¶ˆæ¯çš„å˜é‡
            const variables = await getVariables({ type: 'message', message_id: 'latest' });
            // æ–° API ä¸­, variables ç›¸å½“äºæ—§çš„ message.data, æˆ‘ä»¬ä»ä¸­å¯»æ‰¾ stat_data
            if (!variables || !variables.stat_data) {
                throw new Error("æ— æ³•åœ¨æ¶ˆæ¯å˜é‡ä¸­æ‰¾åˆ° stat_dataã€‚");
            }
            return variables.stat_data;
        } catch (error) {
            console.error("getGameData å¤±è´¥:", error);
            // å¦‚æœé”™è¯¯æ˜¯å› ä¸ºèŠå¤©è®°å½•ä¸ºç©º, åˆ™è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡, é¿å…æ•´ä¸ªé¢æ¿å´©æºƒ
            if (error.message.includes("è¶…å‡ºèŒƒå›´")) {
                console.warn("èŠå¤©è®°å½•ä¸ºç©ºæˆ–æ¶ˆæ¯æ— å˜é‡ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚");
                return {};
            }
            throw error;
        }
    }

    async function saveGameData(updatedStatData) {
        try {
            // ä½¿ç”¨æ–°çš„ API insertOrAssignVariables æ¥å®‰å…¨åœ°æ›´æ–°æˆ–æ’å…¥ stat_data
            await insertOrAssignVariables({ stat_data: updatedStatData }, { type: 'message', message_id: 'latest' });
            
            console.log("æ•°æ®å·²æˆåŠŸä¿å­˜è‡³ SillyTavernã€‚");
            await initDisplay(); // ä¿å­˜åé‡æ–°åŠ è½½æ˜¾ç¤º
        } catch (error) {
            console.error("saveGameData å¤±è´¥:", error);
            alert(`ä¿å­˜æ•°æ®å¤±è´¥: ${error.message}`);
            throw error;
        }
    }
    function SafeGetValue(obj, path, defaultValue = null) { const keys = Array.isArray(path) ? path : path.split('.'); let current = obj; for (const key of keys) { if (current === null || current === undefined || typeof current !== 'object') { return defaultValue; } current = current[key]; } return current === undefined || current === null ? defaultValue : current; }

    // =======================================================================
    // II. GuixuManager - äººç‰©å…³ç³»ç®¡ç†æ¨¡å— (æ— éœ€æ”¹åŠ¨)
    // =======================================================================
    const GuixuManager = {
        idToNameMap: new Map(),
        openModal(id) { const el = document.getElementById(id); if(el) el.style.display = 'flex'; },
        closeModal(id) { const el = document.getElementById(id); if(el) el.style.display = 'none'; },
        async showRelationships() {
            this.openModal('relationships-modal');
            const body = document.querySelector('#relationships-modal .modal-body');
            body.innerHTML = '<p>æ­£åœ¨æ¢³ç†äººè„‰...</p>';
            try {
                const data = await getGameData();
                const relObj = SafeGetValue(data, 'ä¸–ç•Œ.äººç‰©å…³ç³»', {});
                let relationships = Object.keys(relObj)
                    .filter(key => key !== '$meta')
                    .map(key => ({ name: key, ...relObj[key] }));
                
                relationships = this.ensureRelationshipIds(relationships);
                
                this.idToNameMap.clear();
                relationships.forEach(rel => this.idToNameMap.set(rel.id, rel.name));
                
                body.innerHTML = this.renderFullRelationships(relationships);
            } catch (error) {
                body.innerHTML = `<p style="color: red;">åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        },
        renderFullRelationships(relationships) {
            if (!Array.isArray(relationships)) return '<p>äººç‰©å…³ç³»æ•°æ®æ ¼å¼é”™è¯¯ã€‚</p>';
            const filteredRels = relationships.filter(item => typeof item === 'object');
            if (filteredRels.length === 0) return '<p>çº¢å°˜ä¿—ä¸–ï¼Œæš‚æ— çº è‘›ã€‚</p>';
            const controlsHtml = `<div class="relationship-controls"><button class="reorder-relationships-btn" onclick="GuixuManager.handleReorderRelationships()">é‡æ’åºID</button><span class="relationship-count">å…± ${filteredRels.length} ä¸ªäººç‰©å…³ç³»</span></div>`;
            const cardsHtml = filteredRels.map(rel => {
                const id = rel.id ?? 'æœªçŸ¥',
                    name = rel.name ?? 'æœªçŸ¥ä¹‹äºº',
                    relation = rel.relationship ?? 'æœªçŸ¥',
                    intimacy = rel.intimacy ?? 0,
                    description = rel.description ?? 'æš‚æ— æè¿°ã€‚';
                const historyEvents = Array.isArray(rel.event_history) ? rel.event_history.filter(event => typeof event === 'string' && !event.startsWith('$__META')) : [];
                const historyItems = historyEvents.length > 0 ? historyEvents.map(event => `<li>${event}</li>`).join('') : `<li><em>æš‚æ— ç›¸å…³äº‹ä»¶ã€‚</em></li>`;
                return `<div class="relationship-card" data-relationship-id="${id}"><div class="relationship-header"><span class="relationship-id">ID: ${id}</span><div><span class="relationship-name">${name}</span><span class="relationship-relation">- ${relation}</span></div><button class="delete-relationship-btn" onclick="GuixuManager.handleDeleteRelationship(${id})">âœ•</button></div><div class="relationship-body"><p>${description}</p><p>å¥½æ„Ÿåº¦: ${intimacy}</p><div class="favorability-bar-container"><div class="favorability-bar-fill" style="width: ${intimacy}%;"></div></div><div class="event-history"><h4>è¿‡å¾€äº¤é›†</h4><ul>${historyItems}</ul></div></div></div>`;
            }).join('');
            return controlsHtml + cardsHtml;
        },
        async handleDeleteRelationship(id) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤IDä¸º ${id} çš„äººç‰©å…³ç³»å—ï¼Ÿ`)) return;
            const characterName = this.idToNameMap.get(id);
            if (!characterName) {
                return alert(`åˆ é™¤å¤±è´¥: æ— æ³•æ‰¾åˆ°IDä¸º ${id} çš„è§’è‰²ã€‚`);
            }
            try {
                const data = await getGameData();
                const relObj = SafeGetValue(data, 'ä¸–ç•Œ.äººç‰©å…³ç³»', {});
                delete relObj[characterName];
                
                let relationships = Object.keys(relObj)
                    .filter(key => key !== '$meta')
                    .map(key => ({ name: key, ...relObj[key] }));
                
                const reorderedRelationshipsArray = this.reorderRelationshipIds(relationships);
                
                const newRelObj = { '$meta': relObj['$meta'] };
                reorderedRelationshipsArray.forEach(char => {
                    const charName = char.name;
                    delete char.name;
                    newRelObj[charName] = char;
                });
                
                data.ä¸–ç•Œ.äººç‰©å…³ç³» = newRelObj;
                await saveGameData(data);
                this.showRelationships();
            } catch (error) {
                alert(`åˆ é™¤å¤±è´¥: ${error.message}`);
            }
        },
        async handleReorderRelationships() {
            if (!confirm(`ç¡®å®šè¦é‡æ–°æ’åºæ‰€æœ‰äººç‰©å…³ç³»çš„IDå—ï¼Ÿ`)) return;
            try {
                const data = await getGameData();
                const relObj = SafeGetValue(data, 'ä¸–ç•Œ.äººç‰©å…³ç³»', {});
                
                let relationships = Object.keys(relObj)
                    .filter(key => key !== '$meta')
                    .map(key => ({ name: key, ...relObj[key] }));
                
                const reorderedRelationshipsArray = this.reorderRelationshipIds(relationships);
                
                const newRelObj = { '$meta': relObj['$meta'] };
                reorderedRelationshipsArray.forEach(char => {
                    const charName = char.name;
                    delete char.name;
                    newRelObj[charName] = char;
                });
                
                data.ä¸–ç•Œ.äººç‰©å…³ç³» = newRelObj;
                await saveGameData(data);
                this.showRelationships();
            } catch (error) {
                alert(`é‡æ’åºå¤±è´¥: ${error.message}`);
            }
        },
        ensureRelationshipIds(rels) {
            let maxId = 0;
            const objects = rels.filter(r => typeof r === 'object');
            objects.forEach(rel => {
                if (rel.id != null && rel.id > maxId) maxId = rel.id;
            });
            objects.forEach(rel => {
                if (rel.id == null) rel.id = ++maxId;
            });
            return rels;
        },
        reorderRelationshipIds(rels) {
            const objects = rels.filter(r => typeof r === 'object');
            return objects.map((rel, i) => ({ ...rel, id: i + 1 }));
        },
    };

    // =======================================================================
    // III. StatusPanelManager - çŠ¶æ€é¢æ¿æ¸²æŸ“æ¨¡å— (å·²ä¿®å¤)
    // =======================================================================
    const StatusPanelManager = {
        // (ä¿®æ”¹) init å‡½æ•°ç°åœ¨è´Ÿè´£æ‰€æœ‰äº‹ä»¶ç»‘å®š
        init() {
            // 1. ç»‘å®šé¡¶éƒ¨çš„Tabåˆ‡æ¢æŒ‰é’®
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', (e) => this.switchTab(e.currentTarget));
            });

            // 2. (æ–°å¢) ç»‘å®š"ç®¡ç†å…³ç³»ç½‘ç»œ"æŒ‰é’®
            const manageBtn = document.getElementById('manage-relations-btn');
            if (manageBtn) {
                manageBtn.addEventListener('click', () => {
                    GuixuManager.showRelationships();
                });
            } else {
                console.error("æœªèƒ½æ‰¾åˆ°IDä¸º 'manage-relations-btn' çš„æŒ‰é’®ã€‚");
            }
        },
        
        switchTab(tab) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active')); tab.classList.add('active'); document.getElementById(tab.dataset.panelId).classList.add('active'); },
        
        update(data) {
            this.setText('status-identity', SafeGetValue(data, 'ä¸»è§’.èº«ä»½.0'));
            this.setText('status-reputation', SafeGetValue(data, 'ä¸»è§’.å£°æœ›.0'));
            this.setText('status-class-level', SafeGetValue(data, 'ä¸»è§’.èŒä¸šä¸ç­‰çº§.0'));
            const talent = SafeGetValue(data, 'ä¸»è§’.é¾™è¡€å¤©èµ‹.0', null);
            const talentEl = document.getElementById('status-dragon-talent');
            if (talentEl) {
                if (talent && typeof talent === 'object') {
                    talentEl.innerHTML = `<div>${talent.name} (${talent.status})</div><div style="font-size: 0.8em; color: var(--text-secondary); margin-top: 5px;">${talent.description}</div>`;
                    if (talentEl.parentElement) {
                        talentEl.parentElement.style.alignItems = 'flex-start';
                    }
                } else {
                    talentEl.textContent = 'æœªè§‰é†’';
                    if (talentEl.parentElement) {
                        talentEl.parentElement.style.alignItems = 'center';
                    }
                }
            }
            this.renderSkillsList('status-skills-list', SafeGetValue(data, 'ä¸»è§’.æŠ€èƒ½ä¸“é•¿', {}));
            this.setText('res-money', `${SafeGetValue(data, 'åŠ¿åŠ›.é‡‘é’±.0', 0)} é‡‘`);
            this.setText('res-food', `${SafeGetValue(data, 'åŠ¿åŠ›.ç²®è‰.0', 0)} çŸ³`);
            this.renderTerritoriesList('faction-territories-list', SafeGetValue(data, 'åŠ¿åŠ›.é¢†åœ°.0', []));
            this.renderArmyTable('faction-army-tbody', SafeGetValue(data, 'åŠ¿åŠ›.å†›é˜Ÿ', {}));
            const relObj = SafeGetValue(data, 'ä¸–ç•Œ.äººç‰©å…³ç³»', {});
            const relations = Object.keys(relObj).filter(key => key !== '$meta').map(key =>({characterName: key, ...relObj[key]}));
            this.renderCharacterRelations('relations-character-list', relations);
            this.renderWorldStateTable('world-state-tbody', SafeGetValue(data, 'ä¸–ç•Œ.å¤©ä¸‹å¤§åŠ¿', {}));
            this.setText('world-time', SafeGetValue(data, 'ä¸–ç•Œ.å½“å‰æ—¶é—´.0'));
            this.setText('world-age', `${SafeGetValue(data, 'ä¸»è§’.å¹´é¾„.0', '?')} å²`);
        },
        
        setText(id, value) { document.getElementById(id).textContent = value ?? 'N/A'; },
        renderSkillsList(listId, skillsObj) { const listEl = document.getElementById(listId); if (!listEl) return; listEl.innerHTML = ''; if (typeof skillsObj !== 'object' || skillsObj === null) return; Object.keys(skillsObj).filter(key => key !== '$meta').forEach(skillName => { const skill = skillsObj[skillName]; const li = document.createElement('li'); li.className = 'list-item'; li.innerHTML = `<strong>${skillName}:</strong> ${skill.description || ''}`; listEl.appendChild(li); }); },
        renderTerritoriesList(listId, items) { const listEl = document.getElementById(listId); if (!listEl) return; listEl.innerHTML = ''; if (!Array.isArray(items)) return; items.filter(item => typeof item === 'string' && !item.startsWith('$__META')).forEach(item => { const li = document.createElement('li'); li.className = 'list-item'; li.textContent = item; listEl.appendChild(li); }); },
        renderArmyTable(tbodyId, armyObj) { const tbodyEl = document.getElementById(tbodyId); tbodyEl.innerHTML = ''; if (!armyObj || Object.keys(armyObj).filter(k => k !== '$meta').length === 0) { const row = tbodyEl.insertRow(); row.innerHTML = `<td colspan="4" style="text-align:center; color: var(--text-secondary);">æš‚æ— éƒ¨é˜Ÿ</td>`; return; } Object.keys(armyObj).filter(key => key !== '$meta').forEach(armyName => { const army = armyObj[armyName]; const row = tbodyEl.insertRow(); row.innerHTML = `<td>${armyName}</td><td>${army.æ•°é‡}</td><td>${army.å…µç§ç±»å‹}</td><td>${army.çŠ¶æ€}</td>`; }); },
        renderCharacterRelations(listId, relations) { const listEl = document.getElementById(listId); if (!listEl) return; listEl.innerHTML = ''; if (!Array.isArray(relations)) return; relations.filter(item => typeof item === 'object').forEach(rel => { const card = document.createElement('div'); card.className = 'character-card';const displayName = rel.characterName || 'æœªçŸ¥ä¹‹äºº'; card.innerHTML = `<div class="character-header"><span class="character-name">${displayName}</span><span class="character-relation">${rel.relationship}</span></div><div class="character-details"><p><strong>ç§æ—:</strong> ${rel.race || 'æœªçŸ¥'}</p><p><strong>é˜µè¥:</strong> ${rel.faction || 'æœªçŸ¥'}</p><p><strong>èŒä¸š:</strong> ${rel.class_and_level || 'æœªçŸ¥'}</p></div><div class="character-intimacy">äº²å¯†åº¦: ${rel.intimacy}</div><p class="character-description">${rel.description}</p>`; listEl.appendChild(card); }); },
        renderWorldStateTable(tbodyId, factionsObj) { const tbodyEl = document.getElementById(tbodyId); if (!tbodyEl) return; tbodyEl.innerHTML = ''; if (!factionsObj || Object.keys(factionsObj).filter(k => k !== '$meta').length === 0) { const row = tbodyEl.insertRow(); row.innerHTML = `<td colspan="4" style="text-align:center; color: var(--text-secondary);">å¤©ä¸‹å¤§åŠ¿æš‚æœªæ˜æœ—</td>`; return; } Object.keys(factionsObj).filter(key => key !== '$meta').forEach(factionName => { const faction = factionsObj[factionName]; let relationsText = 'æ— '; if (faction.relations && Object.keys(faction.relations).length > 0) { relationsText = Object.entries(faction.relations).map(([k, v]) => `${k}: ${v}`).join(', '); } const row = tbodyEl.insertRow(); row.innerHTML = `<td>${factionName}</td><td>${faction.ruler}</td><td>${faction.status}</td><td>${relationsText}</td>`; }); }
    };

    // =======================================================================
    // IV. ä¸»æ‰§è¡Œé€»è¾‘ (æ— éœ€æ”¹åŠ¨)
    // =======================================================================
    async function initDisplay() {
        try {
            const gameData = await getGameData();
            StatusPanelManager.update(gameData);
        } catch (error) {
            console.error("çŠ¶æ€é¢æ¿åŠ è½½å¤±è´¥:", error);
            document.querySelector('.status-panel').innerHTML = `<div style="padding:20px; color: #bf616a; font-family: monospace;">çŠ¶æ€åŠ è½½å¤±è´¥: ${error.message}</div>`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        StatusPanelManager.init();
        initDisplay();
    });
</script>
</html>
