<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>ç®€åŒ–çŠ¶æ€æ </title>
    <style>
      :root {
        --bg-color: #121212;
        --container-bg: #1e1e1e;
        --text-color: #e0e0e0;
        --text-secondary-color: #b0b0b0;
        --accent-color: #6200ea;
        --accent-light-color: #bb86fc;
        --border-color: #333333;
        --red-color: #cf6679;
        --green-color: #03dac6;
      }
      body {
        font-family: 'Noto Sans SC', sans-serif;
        background-color: var(--bg-color);
        margin: 0;
        padding: 10px;
      }
      .simple-status-container {
        background-color: var(--container-bg);
        color: var(--text-color);
        border-radius: 8px;
        border: 1px solid var(--border-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        margin: auto;
        padding: 16px;
        box-sizing: border-box;
      }
      .simple-header {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }
      .char-name {
        font-size: 18px;
        font-weight: 700;
        color: var(--accent-light-color);
        letter-spacing: 1px;
        margin-bottom: 5px;
      }
      .meta-info {
        font-size: 12px;
        color: var(--text-secondary-color);
      }
      .affection-box {
        background-color: rgba(0, 0, 0, 0.2);
        padding: 12px;
        border-radius: 6px;
        text-align: center;
        margin-bottom: 15px;
      }
      .affection-label {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-secondary-color);
        margin-bottom: 6px;
      }
      .affection-value {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-color);
      }
      .affection-value .arrow {
        font-size: 16px;
        margin: 0 4px;
      }
      .affection-reason {
        font-size: 11px;
        color: var(--text-secondary-color);
        margin-top: 4px;
        font-style: italic;
      }
      .green {
        color: var(--green-color);
      }
      .red {
        color: var(--red-color);
      }
      .thoughts-block {
        background-color: rgba(0, 0, 0, 0.2);
        padding: 12px;
        border-radius: 6px;
      }
      .thoughts-label {
        font-weight: 700;
        color: var(--accent-light-color);
        margin-bottom: 6px;
        display: block;
        font-size: 14px;
      }
      .thoughts-content {
        font-size: 13px;
        line-height: 1.5;
        color: var(--text-color);
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <div id="simple-state-panel" class="simple-status-container">
      <!-- Content will be generated by script -->
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const panel = document.getElementById('simple-state-panel');

        function displayError(message, details = '') {
          console.error('[ç®€åŒ–çŠ¶æ€æ ] ' + message, details);
          panel.innerHTML = `<div style="color: var(--red-color); padding: 15px; font-family: monospace; white-space: pre-wrap;"><h4>çŠ¶æ€æ é”™è¯¯</h4><p>${message}</p><details><summary>è¯¦ç»†ä¿¡æ¯</summary><p>${details}</p></details></div>`;
        }

        try {
          const jsonData = $1;

          function safeGet(obj, path, defaultValue = undefined) {
            const keys = Array.isArray(path) ? path : path.split('.');
            let result = obj;
            for (const key of keys) {
              result = result?.[key];
              if (result === undefined) return defaultValue;
            }
            return result;
          }

          function parseStat(statString) {
            if (typeof statString !== 'string') return null;
            const match = statString.match(/(\d+)\s*â†’\s*(\d+)\s*\((.*?)\)/);
            if (match) {
              return { from: match[1], to: match[2], reason: match[3] };
            }
            return null;
          }

          function updatePanel(data) {
            const name = safeGet(data, 'Name', 'æœªçŸ¥è§’è‰²');
            const location = safeGet(data, 'Status.Location', 'æœªçŸ¥åœ°ç‚¹');
            const time = safeGet(data, 'Status.Time', 'æœªçŸ¥æ—¶é—´');
            const affection = safeGet(data, 'Affection', '');
            const thoughts = safeGet(data, 'Thoughts', 'æš‚æ— å†…å¿ƒæƒ³æ³•è®°å½•');

            panel.innerHTML = `
              <div class="simple-header">
                <div class="char-name">${name}</div>
                <div class="meta-info">ğŸ“ ${location} | ğŸ•°ï¸ ${time}</div>
              </div>
              
              <div class="affection-box">
                <div class="affection-label">ğŸ’• å¥½æ„Ÿåº¦</div>
                <div class="affection-value" data-field="Affection"></div>
              </div>
              
              <div class="thoughts-block">
                <span class="thoughts-label">ğŸ§  å†…å¿ƒæƒ³æ³•</span>
                <div class="thoughts-content">${thoughts}</div>
              </div>
            `;

            // å¤„ç†å¥½æ„Ÿåº¦æ•°æ®
            const affectionElement = panel.querySelector('[data-field="Affection"]');
            if (affectionElement && affection) {
              const parsedStat = parseStat(affection);
              if (parsedStat) {
                affectionElement.innerHTML = `<span class="red">${parsedStat.from}</span> <span class="arrow">â†’</span> <span class="green">${parsedStat.to}</span>`;
                const reasonElement = document.createElement('div');
                reasonElement.className = 'affection-reason';
                reasonElement.textContent = `(${parsedStat.reason})`;
                affectionElement.parentNode.appendChild(reasonElement);
              } else {
                affectionElement.textContent = affection;
              }
            } else if (affectionElement) {
              affectionElement.textContent = 'æœªçŸ¥';
            }
          }

          updatePanel(jsonData);
        } catch (error) {
          displayError(
            'è„šæœ¬æ‰§è¡Œå¤±è´¥ã€‚è¿™é€šå¸¸æ˜¯ç”±äºAIè¾“å‡ºçš„JSONæ ¼å¼ä¸æ­£ç¡®å¯¼è‡´çš„ã€‚',
            `é”™è¯¯ä¿¡æ¯: ${error.message}. æ•è·åˆ°çš„åŸå§‹æ•°æ®: $1`,
          );
        }
      });
    </script>
  </body>
</html>